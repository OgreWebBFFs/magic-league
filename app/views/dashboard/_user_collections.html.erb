<div id="collection-table" class="container">

  <h3>Collection   <%= link_to 'Edit Collection', edit_collection_path(user.collection.id), class: 'main-toggle btn' if policy(user.collection).edit? %></h3>
  <div  class="alternating three-col table">
    <div class="row headings">
      <p>Card</p>
      <p>Amount</p>
      <p>Tradable</p>
    </div>
    <% @cards.each do |card| %>
    <div class="row">
      <p><%= card.name %></p>
      <p><%= @cards.count[card.id] %></p>
      <div class="checkbox-container">
        <div class="checkbox">
          <input type="checkbox" <%= checked_if_tradable(@tradables, card) %> <%= disabled_if_not_current_user(user) %> data-id="<%= card.id %>" id="<%= "#{card.name}_#{card.id}" %>">
          <label for="<%= "#{card.name}_#{card.id}" %>"></label>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>

<script>
  var alertTemplate = function(key, value) {
    return `
    <div id="alert-container" class="active alert alert-${key}">
    ${value}
          <a class="close-button" href="#" onclick="Helpers.toggleElementById('alert-container')" data-turbolinks="false">&#9650;</a>
    </div>
    `
  };
  $(function() {
    $('.checkbox input').on('click', function() {
      console.log($(this));
      id = $(this).attr('data-id');
      that = this;
      if ($(this).is(':checked')) {
        xhrRequest('/tradables', 'POST', function(res) {
          $(that).data('tradable-id', res.id)
          console.log(res);
        }, {card: {id: id}});
      } else {
        if ($(this).data('tradable-id') != undefined) {
          xhrRequest(`/tradables/${$(this).data('tradable-id')}`, 'DELETE',
            function(res){
             console.log(res);
            }, {},
            function(res) {
              $('.section.full-page').prepend(alertTemplate('danger', res.responseText))
              window.scrollTo(0,0);
              console.log(res)
          });
        }
      }
    });
  });

</script>
