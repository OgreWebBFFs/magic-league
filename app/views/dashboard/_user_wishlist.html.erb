<div id="wishlist" class="dashboard_card-view">
<div class="dashboard_card-interface_action-bar">
<%= link_to 'Edit', edit_collection_path(user.collection.id), class: 'dashboard_card-interface_action-btn' if policy(user.collection).edit? %>
</div>
   <div id="wishlist-table" class="dashboard_card-view-table">
    <div class="dashboard_card-view-row-headings">
      <div class="dashboard_card-view-cell">Card</div>
       <script>
        var cardRow = function(card) {
        if (<%=current_user.id%>===<%= @user.id %>){
        return `
          <div class="dashboard_card-view-row wishlist-item">
            <div class="dashboard_card-view-cell">
              ${card.name}
            </div>
            <div class="dashboard_card-view-cell">
            <input class="dashboard_wishlist-toggle" type="checkbox" checked <%= disabled_if_not_current_user(user) %> data-id="${card.id}" id="${card.name}_${card.id}">
            <label class="dashboard_wishlist-toggle" for="${card.name}_${card.id}"></label>
            </div>
          </div>
         `
        }
       else{
       return `
          <div class="dashboard_card-view-row wishlist-item">
            <div class="dashboard_card-view-cell">${card.name}</div>
            <div class="dashboard_card-view-cell"></div>
          </div>
        `
        }
     };

        $(function() {

          xhrRequest('/wishlists/<%= @user.id %>', 'GET', function(res){
            $('.wishlist-item').remove()
            res.forEach(function(card) {
              $('#wishlist-table').append(cardRow(card));
            });
          });

          $(document).off('click', '.dashboard_wishlist-toggle');
          $(document).on('click', '.dashboard_wishlist-toggle', function(){
            card_id = $(this).attr('data-id');
            that = this;
            $.ajax({
              url: '/wishlists/<%= @user.id %>',
              beforeSend: function (xhr) {
                xhr.setRequestHeader("X-CSRF-Token", token)
              },
              type: "PUT",
              data: { card_id: card_id },
              dataType: 'json',
              success: function(res) {
                $(that).closest('.dashboard_card-view-row').remove();
              },
              error: function(res) {
              }
            });
          });
        });
      </script>
    </div>
  </div>
</div>
